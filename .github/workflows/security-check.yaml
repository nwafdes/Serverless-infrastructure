name: Security Scans

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
# schedule
  workflow_dispatch:

permissions:
  actions: read
  contents: read
  security-events: write  # ðŸ§¨ Required for CodeQL to report results

jobs:
#   codeql:
#     name: CodeQL Analysis
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4

#       - name: Initialize CodeQL
#         uses: github/codeql-action/init@v3
#         with:
#           languages: python

#       - name: Perform CodeQL Analysis
#         uses: github/codeql-action/analyze@v3

  bandit:
    name: Python Static Analysis (Bandit)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Install Bandit
        working-directory: pytestt
        run: pip install -r requirements.txt

      - name: Run Bandit Scan
        working-directory: pytestt/app/
        run: |
          pwd
          bandit lambda_function.py -f json -o bandit_report.json

      - name: Upload Bandit Report
        uses: actions/upload-artifact@v4
        with:
          name: bandit_report
          path: pytestt/app/bandit_report.json

#   tfsec:
#     name: Terraform Static Analysis (Tfsec)
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4

#       - name: Install tfsec
#         run: |
#           curl -s https://raw.githubusercontent.com/aquasecurity/tfsec/master/scripts/install_linux.sh | bash

#       - name: Run tfsec
#         run: tfsec Infastructure/
